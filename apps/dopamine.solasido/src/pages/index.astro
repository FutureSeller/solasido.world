---
import Layout from '../layouts/Layout.astro'
import PostList from '../components/PostList.astro'
import { fetchPublishedPosts } from '../lib/data'
import { PAGE_SIZE, buildPagination, getPageItems, getTotalPages } from '../lib/pagination'
import { SITE_DESCRIPTION, SITE_NAME } from '../lib/site-meta'
import { buildCollectionPageStructuredData } from '../lib/structured-data'
const posts = await fetchPublishedPosts()
const totalPages = getTotalPages(posts.length, PAGE_SIZE)
const firstPagePosts = getPageItems(posts, 1, PAGE_SIZE)
const page = buildPagination(1, totalPages)
const pageUrl = Astro.url.href
const origin = Astro.url.origin
const structuredData = buildCollectionPageStructuredData({
  pageUrl,
  origin,
  posts: firstPagePosts,
})
---

<Layout
  title={SITE_NAME}
  description={SITE_DESCRIPTION}
  structuredData={structuredData}
>
  <PostList posts={firstPagePosts} page={page} />
</Layout>
